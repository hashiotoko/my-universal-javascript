# ビルドツール

## そもそもビルドとは

* 端的には「実装したコード」を「実行用のコード」に変換すること
* 主に bundle, transpile, minify の工程があり、それを実現するために幾つかのツールを使用する
  * bundle ... 複数のファイルのコードを1つのファイルにまとめる
    * 実装観点: 複数のファイルに分割した方が保守性が上がる
    * 実行観点: 少ないファイルの方がダウンロードに時間がかからず、パフォーマンスが良くなる
  * transpile ... 新しい規格や実装メリットのあるコード形式を実行可能な古い規格に変換する
    * 実装観点: 新しい規格(ex: ES)や実装メリットのあるコード形式(ex: 静的型付け)の方がよりDX的に良い
    * 実行観点: 実行体が対応できる規格は古い場合が多く、型も実行時には不要
  * minify ... 実行において不要なインデントやコメントなどを取り除く
    * 実装観点: インデントやコメントはコードの可読性を上げる
    * 実行観点: ファイルのサイズが小さいほどダウンロード量が減り、パフォーマンスが良くなる

(補足)ビルドツールのその他の役割

* モジュール管理 ... 必要なモジュールだけを必要な箇所で読み込めるようにする
* ライブリロード ... 開発時などにコードの変更をリアルタイムにブラウザに反映する

## ビルドツールが誕生した経緯

* もともとjsはファイル(モジュール)分割されたコードを組み合わせて使う場合にグローバルな変数に突っ込んで使っていた
* が、名前の競合やコードの重複などで問題となり、モジュールごとのスコープのままで扱えるようにする(=モジュールシステム)動きが盛んになった
* その際に CommonJS や ECMAScript と呼ばれるjsの言語仕様が提案され、その中で CommonJS(Modules) と ESModules という競合するモジュールシステムの仕様が生まれた
  * CommonJS ... `require`, `module.exports` を使う形式。node.jsでデフォルトで採用されていたが近年は ESModules に移行傾向。
  * ESModules ... `import`, `export` を使う形式。CommonJS 形式も使用可能で上位互換的な立ち位置。
* 上記のような仕様のばらつきをまとめるためにビルドツールが生まれた
* その後、標準化の動きがより進み、CommonJS のみ対応していたブラウザのIEのサポート切れなどから、ESModules に統一されつつある。

(ref)
* https://www.crunchtimer.jp/blog/17769
* https://qiita.com/mizchi/items/6b569cc75dbcc26a1f15
* https://qiita.com/skanno/items/cd57fa5a7e78d2d5ebd5

## ビルドツールの候補(主にフロントエンド)

* [create-react-app](https://create-react-app.dev/) ... react アプリサクッと作りたいならあり
  * react の入門キット的なものでワンコマンドで react 開発環境の整備ができる
  * 裏で webpack や babel を隠蔽して動かしているらしい
    * ゆえに細かい設定が不要で簡単に開発環境が立ち上げられたりビルドできたり
    * とはいえ、細かい設定したくなるのでそのあたりで別のビルドツールに移行したくなる
  * [こんな記事](https://zenn.dev/nekoya/articles/dd0f0e8a2fa35f)もありオワコン感
* [webpack](https://webpack.js.org/) ... ビルドは遅いが大概のケースには対応できる
  * JavaScript 向けのモジュールバンドラー(JSファイルだけでなく、CSSとか画像とかもJSファイルとしてまとめられる)
  * bundle や minify を行う
  * babel あるいは xxx-loader を併用するのは transpile を任せるため
* [esbuild](https://esbuild.github.io/) ... ビルドは早いがまだv1になってない
  * golang で実装されたjs, ts, css ビルドツール
  * キャッシュなしで高速なビルドを実現している(webpack の10~100倍早い)
    * 並列処理に強い golang で機械語にコンパイルして実行しているため
    * ほとんどのビルドツールはjsで書かれ、JIT(Just-In-Time)コンパイラを使用しているので遅いらしい
  * ts の型チェックはは非対応なのでビルド前に `tsc --noEmit` を走らせる必要がある
  * まだv1まで上がってない
* [rollup](https://rollupjs.org/) ... ライブラリ製作時に適している
  * モジュールの最適化に特化しており、jsライブラリ開発者向けに設計されている
    * ツリーシェイキング(ビルド中に未使用コードを削除する)よりファイルサイズを圧縮する
    * ES Modules ベースのバンドルによって軽量にできる
    * ref. [webpackとrollupの違い](https://postd.cc/webpack-and-rollup-the-same-but-different/)
  * プラグイン数はwebpackより少ないので自分で用意する必要がある
* [percel](https://ja.parceljs.org/) ... サクッと個人で小さいアプリとか作るのには良い
  * 設定ファイル不要ですぐにビルド環境(開発環境)が構築できる
  * ts, reactなどには対応しているが多機能ではないので痒い所に手が届かないこともありそう
  * ミニマム
* [vite](https://ja.vitejs.dev/) ... react とか使ってて開発効率を重視している場合に適している
  * DX向上のために開発サーバーとして esbuild を、本番での安定稼働のために本番環境向けに Rollup を使用している
  * デフォルトで設定不要で開発可能
  * ビルドが高速でHMR(Hot Module Replacement)も高速らしい
  * プリセットが充実しており react や vue に最適化されている
* [bun](https://bun.sh/) ... 今後はこれにまとまっていく可能性もあるかも
  * nodejs と高い互換性がある超高速な js ランタイム
  * 組み込みで typescript の実行にも対応
  * パッケージマネージャとしても使用できる
  * ビルドツールとしての機能も含んでいる
  * テストも実行可能( jest と互換性あり )
